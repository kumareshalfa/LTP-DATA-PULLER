<?php error_reporting(E_ERROR|E_PARSE);require_once'ltp_date_range_config.php';try{if(!file_exists($logFilesFolder))mkdir($logFilesFolder,0777,true);}catch(Exception $z1){print_r($z1);}$d2=strtotime($startDt);$s4=strtotime($endtDt);echo "start:".$d2." end:".$s4;$i6=array();$h7=strtotime(date("Y-m-01 00:00:00",$d2));while($h7<=$s4){$i6[]="devicelogs_".date("n_Y",$h7);$h7=strtotime("+1 month",$h7);}$i6=array_unique($i6);$d8=array();foreach($i6 as $q9){$c10=" SELECT DATE_FORMAT(LogDate,'%Y%m%d') as punchdate,DATE_FORMAT(LogDate,'%H%i%s') as punchtime,
    log.Direction,de.DevicesName,log.DeviceId,log.UserId as cardNumber
    FROM ".$q9." log
    left join devices de on log.DeviceId=de.DeviceId
    WHERE (log.LogDate >= '".date("Y-m-d H:i:s",$d2)."' AND log.LogDate <'".date("Y-m-d H:i:s",$s4)."')
    ";$c11=$mysqli->query($c10);if(mysqli_num_rows($c11)>0){foreach($c11 as $j13){$j14="";$l15="";$l16="";$b17="0";if(!empty($j13['cardNumber'])){$l15=substr($j13['cardNumber'],0,20);}if(!empty($j13['DevicesName'])){$l16=substr($j13['DevicesName'],0,20);}$j14=str_pad($l15,20,"-",STR_PAD_LEFT).$j13['punchdate'].$j13['punchtime'].$b17.str_pad($l16,20,"-",STR_PAD_LEFT);$d8[]=$j14;}}}if(!empty($d8)){$j18=$logFilesFolder.DS.$fileNamePrefix.date("YmdHi",$s4).".txt";if(!file_exists($j18)){$y20=fopen($j18,'w+');}file_put_contents($j18,implode($d8,PHP_EOL));}?>